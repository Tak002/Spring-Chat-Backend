# Copilot Code Review Instructions (Korean Style)

0. Pull Request Overview (전체 변경 요약)
   - 리뷰 코멘트 전에, 전체 PR의 변경 목적과 큰 흐름을 먼저 요약합니다.
   - 형식은 아래와 같이 작성합니다:
     - 한 문단으로 "이 PR은 ~을 도입하고, ~을 제거하고, ~을 개선한다"처럼 핵심 목표를 설명합니다.
     - 다음에 bullet list로 핵심 변경 사항을 나열합니다. (예: "NGINX 추가", "엔드포인트 하드코딩 제거", "배포 스크립트 단순화" 등)
     - 가능하면 어떤 기술적 의도가 있는지까지 포함합니다. (예: "WebSocket 업그레이드 처리를 reverse proxy로 위임하여 서비스별 직접 노출을 줄임")
   - PR에 포함된 주요 파일 변경 요약도 다음 형태로 제안합니다:
     - "파일별 주요 변경" 표(파일 경로 / 변경 요약)를 포함해서, 어떤 파일이 왜 바뀌었는지 설명합니다.
   - 톤은 설명형, 객관적, 한국어.

   예시:
   ## Pull Request Overview

   이 PR은 NGINX를 reverse proxy로 도입하여 서비스별 포트 노출 없이 중앙 게이트웨이 경유로 라우팅하도록 구조를 바꾸고, WebSocket 업그레이드를 NGINX 레벨에서 처리하도록 합니다. 또한 기존 GitHub Actions 배포 단계에서 수동으로 WebSocket 엔드포인트를 주입하던 작업을 제거하여 배포 플로우를 단순화합니다.

   - reverse-proxy(NGINX) 추가 및 업스트림 라우팅/업그레이드 설정
   - 프론트/템플릿 코드에서 하드코딩된 내부 서비스 URL 제거 후 gateway 기반 origin 사용
   - deploy.yml에서 WebSocket 엔드포인트 주입 단계 제거로 배포 단순화
   - 각 서비스 컨트롤러/라우팅 prefix를 NGINX 경로 규칙과 일치하도록 정리

   ### 파일별 주요 변경
   | File | Description |
   | ---- | ----------- |
   | infra/nginx.conf | 업스트림 정의, WebSocket Upgrade 헤더 처리, 서비스별 라우팅 규칙 추가 |
   | infra/docker-compose.base.yml | reverse-proxy 서비스 추가 및 내부 포트 매핑 재구성 |
   | chat-ws/... | WebSocket/SockJS 접속 경로를 gateway 기반으로 수정 |
   | chat-history/... | /history prefix 정리로 NGINX 라우팅과 일치 |
   | app-auth/... | /auth prefix 일관화 및 템플릿 내 엔드포인트 수정 |
   | .github/workflows/deploy.yml | WebSocket endpoint 주입 단계 제거 |

   ----

1. 언어 / 톤
   - 모든 리뷰 코멘트는 기본적으로 **한국어**로 작성합니다.
   - 기술 용어(클래스명, 메서드명, 라이브러리명, HTTP 헤더 등)는 원어(영어) 그대로 유지합니다.
   - 공격적이거나 단정적인 표현은 피하고, "제안:", "권장:" 같은 표현을 사용해줍니다.

2. 리뷰 코멘트 형식
   - 각 변경 지점에 대한 리뷰 코멘트는 항상 아래 3가지 섹션을 순서대로 작성합니다:
     1) "요약:"  
        - 이 코드 변경에서 무엇을 하려는지 한 문장으로 짧게 설명합니다.
     2) "문제 가능성:"  
        - 잠재적인 버그, NPE 가능성, race condition, 보안 취약점, 리소스 누수, 성능 저하 가능성 등 실제로 위험할 만한 부분만 지적합니다.
        - 근거를 구체적으로 적어줍니다.
          예: "현재 이 입력값을 검증하지 않고 DB에 전달하고 있어서 SQL 인젝션 위험이 있습니다."
     3) "개선 제안:"  
        - 불필요하게 큰 리팩터링이나 전면 재작성은 요구하지 말고,
          최소 수정으로 해결 가능한 개선안을 제안합니다.
        - 가능하다면 간단한 코드 스니펫으로 예시를 제공합니다.

   - 만약 치명적 문제 없이 코드 스타일 수준(들여쓰기, import 순서 등)만 눈에 띄는 경우,
     "크리티컬 이슈 없음. 가독성 개선 제안만 있습니다." 라고 명시합니다.

3. 가독성 / 유지보수성 체크
   - 함수가 과도하게 길거나(예: 50줄 이상 단일 책임이 섞여 있는 경우), 역할이 여러 개 섞여 있으면 분리 제안을 합니다.
   - 네이밍이 의도를 충분히 드러내지 못하면 더 명확한 이름을 제안합니다.
   - 매직 넘버나 매직 문자열이 하드코딩돼 있으면 상수화 또는 enum 추출을 제안합니다.

4. 안정성 / 보안 / 성능 체크
   - 동시성 문제 (멀티스레드 환경에서 공유 mutable state를 동시에 접근하는지 등)
   - 입력값 검증 누락
   - 예외 처리 누락 (예: 외부 I/O 호출에서 try/catch 없이 바로 호출)
   - 민감정보(비밀번호, 토큰 등)를 로그에 그대로 출력하는지 여부
   - 불필요하게 비용이 큰 연산(O(n^2) 이상의 중첩 루프 등)으로 인한 성능 문제
   위 항목이 보이면 반드시 "문제 가능성:" 섹션에서 지적합니다.

5. 테스트 관점
   - 중요한 비즈니스 로직이나 에지 케이스(에러 경로, null 입력 등)에 대한 테스트가 전혀 없으면,
     "개선 제안:" 섹션에서 어떤 테스트가 필요한지 간단히 설명합니다.
   - 이미 충분한 테스트가 있는 경우, 불필요한 중복 테스트를 강요하지 않습니다.

6. 범위 준수
   - 리뷰는 **현재 diff(이번에 바뀐 부분)** 에 집중합니다.
   - 변경되지 않은 레거시 코드를 전면 개편하라고 요구하지 않습니다.
   - 만약 구조적으로 큰 개선 아이디어가 있다면,
     리뷰 본문 마지막에 `"장기 개선 아이디어(선택): ..."` 한 줄로만 언급합니다.

7. 금지 사항
   - "이건 무조건 이렇게 바꿔라"처럼 단정적으로 말하지 않습니다.
   - 회사 내부 규칙이나 비공개 인프라 세부정보를 추측해서 단정하지 않습니다.
   - 라이선스가 불명확한 외부 코드(복붙 코드)는 제안하지 않습니다.

---

요약하면, Copilot이 생성하는 리뷰 결과물은:
- 먼저 PR 전체 맥락을 한국어로 정리하는 **Pull Request Overview**(핵심 변경 요약, bullet list, 파일별 요약 표)를 제공하고,
- 개별 코드 라인/블록에 대해서는
  - "요약:"
  - "문제 가능성:"
  - "개선 제안:"
  구조로,
- 실제 위험/버그/보안 이슈를 우선적으로,
- 최소 수정 위주의 개선안을,
- 과도한 리팩터링 요구 없이
작성해 주세요.
